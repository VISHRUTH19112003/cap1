{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile in the NyayaGPT application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user profile was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the user profile was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName",
        "createdAt",
        "updatedAt"
      ]
    },
    "Document": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Document",
      "type": "object",
      "description": "Represents a legal document uploaded by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the document."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Document)"
        },
        "fileName": {
          "type": "string",
          "description": "Original file name of the uploaded document."
        },
        "fileType": {
          "type": "string",
          "description": "MIME type of the uploaded document (e.g., application/pdf)."
        },
        "fileSize": {
          "type": "number",
          "description": "Size of the uploaded document in bytes."
        },
        "uploadDate": {
          "type": "string",
          "description": "Timestamp indicating when the document was uploaded.",
          "format": "date-time"
        },
        "jurisdiction": {
          "type": "string",
          "description": "The jurisdiction of the document (e.g., 'Indian Law')."
        },
        "legalTaxonomy": {
          "type": "string",
          "description": "Legal taxonomy or category of the document."
        }
      },
      "required": [
        "id",
        "userId",
        "fileName",
        "fileType",
        "fileSize",
        "uploadDate",
        "jurisdiction",
        "legalTaxonomy"
      ]
    },
    "ApplicationSetting": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ApplicationSetting",
      "type": "object",
      "description": "Represents user-specific application settings.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the application setting."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N ApplicationSetting)"
        },
        "defaultPage": {
          "type": "string",
          "description": "User's preferred default page upon login."
        },
        "language": {
          "type": "string",
          "description": "User's preferred language."
        },
        "aiModelParameters": {
          "type": "string",
          "description": "Serialized AI model parameters (e.g., JSON string)."
        },
        "privacyOptions": {
          "type": "string",
          "description": "Serialized privacy options (e.g., JSON string)."
        }
      },
      "required": [
        "id",
        "userId",
        "defaultPage",
        "language",
        "aiModelParameters",
        "privacyOptions"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profiles. Includes parameters to ensure that the correct user id is used for authorization.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user.  Used to control access to the UserProfile data."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/documents/{documentId}",
        "definition": {
          "entityName": "Document",
          "schema": {
            "$ref": "#/backend/entities/Document"
          },
          "description": "Stores legal documents uploaded by users. Documents are stored under the userId for easy retrieval and management. Includes parameters to ensure that the correct user and document ID is used for authorization.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user who owns the document.  Used to control access to the Document data."
            },
            {
              "name": "documentId",
              "description": "The unique identifier for the document."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/applicationSettings/{settingId}",
        "definition": {
          "entityName": "ApplicationSetting",
          "schema": {
            "$ref": "#/backend/entities/ApplicationSetting"
          },
          "description": "Stores user-specific application settings. Includes parameters to ensure that the correct user and settings ID is used for authorization.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user who owns the application setting. Used to control access to the ApplicationSetting data."
            },
            {
              "name": "settingId",
              "description": "The unique identifier for the application setting."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging, in accordance with the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs.\n\n**Authorization Independence:**\n\n*   User profiles, documents, and application settings are all structured to avoid hierarchical authorization dependencies. Each document stores all the information necessary to determine access rights, eliminating the need for `get()` calls in security rules. Specifically, documents are stored under the user's ID `/users/{userId}/documents/{documentId}`, application settings are stored under the user's id `/users/{userId}/applicationSettings/{settingId}`. This ensures that each document and application setting is directly tied to a user.\n\n**Clarity of Intent:**\n\n*   The structure is designed to make authorization intent explicit. Ownership is clearly defined by the hierarchical path structure, and access control is directly tied to the user ID.\n\n**DBAC (No Custom Claims):**\n\n*   Authorization relies solely on `request.auth.uid`. No custom claims are used. Roles or permissions are not explicitly modeled in this iteration but if needed in the future can be added as separate documents under each user. Example: `/users/{userId}/roles/{roleId}`\n\n**QAPs (Rules are not Filters):**\n\n*   The structure supports secure `list` operations by segregating data based on ownership. Listing documents or application settings under `/users/{userId}` is secure because the rules can easily check if `request.auth.uid == userId`.\n\n**Invariants:**\n\n*   The structure supports the integrity of ownership because each document is stored under the user's ID. Timestamps such as `createdAt` and `updatedAt` are stored directly in the `UserProfile`, `Document`, and `ApplicationSetting` entities. Denormalization is primarily focused on ownership, ensuring that access control data is readily available within each document.\n\n**Structural Segregation:**\n\n*   User profiles, documents, and application settings are stored in separate collections or subcollections to avoid mixing data with different access needs.\n\n**Access Modeling:**\n\n*   Path-based ownership is used for private data. Documents and application settings are stored under `/users/{userId}`.\n\n**Data Clarity and Predictability:**\n\n*   Explicit state modeling and predictable schema conventions are followed. Naming conventions are strict and semantic (e.g., `userId`, `documentId`, `settingId`)."
  }
}
    