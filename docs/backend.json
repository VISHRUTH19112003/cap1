{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the NyayaGPT application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "profileName": {
          "type": "string",
          "description": "The display name chosen by the user."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "profileName",
        "createdAt",
        "updatedAt"
      ]
    },
    "Document": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Document",
      "type": "object",
      "description": "Represents a legal document uploaded by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Document entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Document)"
        },
        "filename": {
          "type": "string",
          "description": "Original filename of the uploaded document."
        },
        "contentType": {
          "type": "string",
          "description": "MIME type of the document (e.g., application/pdf)."
        },
        "uploadDate": {
          "type": "string",
          "description": "Timestamp indicating when the document was uploaded.",
          "format": "date-time"
        },
        "fileSize": {
          "type": "number",
          "description": "Size of the document in bytes."
        },
        "storageLocation": {
          "type": "string",
          "description": "Location where the document is stored (e.g., S3 bucket URL)."
        }
      },
      "required": [
        "id",
        "userId",
        "filename",
        "contentType",
        "uploadDate",
        "fileSize",
        "storageLocation"
      ]
    },
    "LegalSearchQuery": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LegalSearchQuery",
      "type": "object",
      "description": "Represents a legal search query performed by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the LegalSearchQuery entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N LegalSearchQuery)"
        },
        "queryText": {
          "type": "string",
          "description": "The text of the legal search query."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp indicating when the search query was performed.",
          "format": "date-time"
        },
        "results": {
          "type": "array",
          "description": "List of document IDs returned as search results.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "queryText",
        "timestamp",
        "results"
      ]
    },
    "LegalArgument": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LegalArgument",
      "type": "object",
      "description": "Represents a legal argument generated by the AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the LegalArgument entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N LegalArgument)"
        },
        "prompt": {
          "type": "string",
          "description": "The user's input prompt used to generate the argument."
        },
        "argumentText": {
          "type": "string",
          "description": "The generated legal argument text."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp indicating when the argument was generated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "prompt",
        "argumentText",
        "timestamp"
      ]
    },
    "ContractAnalysis": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ContractAnalysis",
      "type": "object",
      "description": "Represents an analysis of a legal contract.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ContractAnalysis entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N ContractAnalysis)"
        },
        "documentId": {
          "type": "string",
          "description": "Reference to Document. (Relationship: Document 1:N ContractAnalysis) The ID of the document being analyzed, if uploaded."
        },
        "contractText": {
          "type": "string",
          "description": "The text of the contract being analyzed (if not uploaded as a document)."
        },
        "analysisReport": {
          "type": "string",
          "description": "The analysis report generated by the AI."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp indicating when the analysis was performed.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "timestamp",
        "analysisReport"
      ]
    },
    "Setting": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Setting",
      "type": "object",
      "description": "Represents a user-configurable application setting.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Setting entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Setting)"
        },
        "settingKey": {
          "type": "string",
          "description": "The name/key of the setting."
        },
        "settingValue": {
          "type": "string",
          "description": "The value of the setting."
        }
      },
      "required": [
        "id",
        "userId",
        "settingKey",
        "settingValue"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information.  Path-based ownership ensures only the authenticated user can access their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/documents/{documentId}",
        "definition": {
          "entityName": "Document",
          "schema": {
            "$ref": "#/backend/entities/Document"
          },
          "description": "Stores legal documents uploaded by users. Path-based ownership ensures only the authenticated user can access their own documents.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "documentId",
              "description": "The unique ID of the document."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/legalSearchQueries/{legalSearchQueryId}",
        "definition": {
          "entityName": "LegalSearchQuery",
          "schema": {
            "$ref": "#/backend/entities/LegalSearchQuery"
          },
          "description": "Stores legal search queries performed by users. Path-based ownership ensures only the authenticated user can access their own search queries.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "legalSearchQueryId",
              "description": "The unique ID of the legal search query."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/legalArguments/{legalArgumentId}",
        "definition": {
          "entityName": "LegalArgument",
          "schema": {
            "$ref": "#/backend/entities/LegalArgument"
          },
          "description": "Stores legal arguments generated by the AI for users. Path-based ownership ensures only the authenticated user can access their own legal arguments.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "legalArgumentId",
              "description": "The unique ID of the legal argument."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/contractAnalyses/{contractAnalysisId}",
        "definition": {
          "entityName": "ContractAnalysis",
          "schema": {
            "$ref": "#/backend/entities/ContractAnalysis"
          },
          "description": "Stores contract analyses generated by the AI for users. Path-based ownership ensures only the authenticated user can access their own contract analyses.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "contractAnalysisId",
              "description": "The unique ID of the contract analysis."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/settings/{settingId}",
        "definition": {
          "entityName": "Setting",
          "schema": {
            "$ref": "#/backend/entities/Setting"
          },
          "description": "Stores user-specific settings. Path-based ownership ensures only the authenticated user can access their own settings.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "settingId",
              "description": "The unique ID of the setting."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure Authorization Independence, DBAC, and QAPs. It leverages path-based ownership for private user data and denormalization where necessary to avoid `get()` calls in security rules.\n\n*   **User Data:**  User profiles and settings are stored under `/users/{userId}`. This ensures that only the authenticated user can access their own data.\n*   **Documents, Queries, Arguments, Contract Analyses:** These are stored under `/users/{userId}/{collection}/{entityId}` enabling easy ownership-based access control. This structure directly represents the `User 1:N Entity` relationships.\n\nThis structure achieves **Authorization Independence** because access control is determined by the path and the authenticated user's ID (`request.auth.uid`) without requiring additional database reads (`get()` calls).  **QAPs (Rules are not Filters)** is supported because listing operations are naturally scoped to the user's data, so security rules don't need to filter based on document content.  **DBAC** is achieved by using `request.auth.uid` exclusively for authentication and authorization, without relying on custom claims."
  }
}